<!DOCTYPE html>
<!--
html_game_engine
v003d2 - CSS Add same colors as the DevEnviroment
v003d1 - external html template


ToDo:
-

--> 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exported Game</title>
    <style>
        body { font-family: monospace; background: #f4f4f4;}
        #grid { display: grid; grid-template-columns: repeat(20, 20px); }      
        .cell { width: 20px; height: 20px; text-align: center; border: 1px solid #ccc; cursor: pointer; }
        .player { background: lightblue; }
        .enemy { background: lightcoral; }
        .obstacle { background: lightgray; }
        .goal { background: lightgreen; }
        .gold { background: gold; }
        .wall1 { background: darkgray; }
        .wall2 { background: gray; }
        img { width: 100%; height: 100%; }
    </style>
</head>
<body>
    <h1>Exported Game</h1>
    <div id="grid"></div>
    <script>
        const gridSize = <!-- gridSize -->;
        let gridArray = <!-- gridArray -->;
        let images = <!-- images -->;
        let playerPosition = findPlayerPosition();
        let goldCollected = 0;

        function findPlayerPosition() {
            for (let row = 0; row < gridSize; row++) {
                for (let col = 0; col < gridSize; col++) {
                    if (gridArray[row][col] === 'P') {
                        return { x: col, y: row };
                    }
                }
            }
            return null;
        }

        const gridElement = document.getElementById('grid');
        initGrid();

        function initGrid() {
            gridElement.innerHTML = '';
            for (let row = 0; row < gridSize; row++) {
                for (let col = 0; col < gridSize; col++) {
                    const cell = document.createElement('div');
                    const symbol = gridArray[row][col];
                    const imgSrc = images[symbol] || null;
                    cell.innerHTML = imgSrc ? '<img src="' + imgSrc + '" alt="' + symbol + '">' : symbol;
                    cell.className = 'cell ' + getClassNameForSymbol(symbol); // add class for coloring
                    gridElement.appendChild(cell);
                }
            }
            if (playerPosition) {
                updatePlayerCell();
            }
        }

        function getClassNameForSymbol(symbol) {
            switch (symbol) {
                case 'P': return 'player';
                case 'E': return 'enemy';
                case '#': return 'obstacle';
                case '&': return 'goal';
                case '$': return 'gold';
                case '[': return 'wall1';
                case ']': return 'wall2';
                default: return '';
            }
        }

        function updatePlayerCell() {
            const cell = gridElement.children[playerPosition.y * gridSize + playerPosition.x];
            const imgSrc = images['P'] || null;
            cell.innerHTML = imgSrc ? '<img src="' + imgSrc + '" alt="P">' : 'P';
            cell.className = 'cell player';
        }

        // Move player logic
        function movePlayer(dx, dy) {
            const newX = playerPosition.x + dx;
            const newY = playerPosition.y + dy;

            if (newX >= 0 && newX < gridSize && newY >= 0 && newY < gridSize) {
                const targetCell = gridArray[newY][newX];
                if (targetCell === '.' || targetCell === '&' || targetCell === '$') {
                    if (targetCell === '$') {
                        goldCollected++;
                        console.log("gold=" + goldCollected);
                    }
                    gridArray[playerPosition.y][playerPosition.x] = '.';
                    playerPosition.x = newX;
                    playerPosition.y = newY;
                    gridArray[playerPosition.y][playerPosition.x] = 'P';
                    initGrid();
                    if (targetCell === '&') {
                        alert("You win! You collected " + goldCollected + " gold.");
                        goldCollected = 0; // Reset gold for a new game
                    }
                }
            }
        }

        document.addEventListener('keydown', (event) => {
            if (playerPosition) {
                switch (event.key) {
                    case 'ArrowUp':
                        movePlayer(0, -1);
                        break;
                    case 'ArrowDown':
                        movePlayer(0, 1);
                        break;
                    case 'ArrowLeft':
                        movePlayer(-1, 0);
                        break;
                    case 'ArrowRight':
                        movePlayer(1, 0);
                        break;
                }
            }
        });
    </script>
</body>
</html>